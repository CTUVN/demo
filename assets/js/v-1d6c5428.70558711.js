(self.webpackChunk=self.webpackChunk||[]).push([[3907],{4974:(s,n,a)=>{"use strict";a.r(n),a.d(n,{data:()=>l});const l={key:"v-1d6c5428",path:"/zh/advanced/cookbook/usage-of-client-app-enhance.html",title:"Client App Enhance 的使用方法",lang:"zh-CN",frontmatter:{},excerpt:"",headers:[{level:2,title:"注册 Vue 组件",slug:"注册-vue-组件",children:[]},{level:2,title:"使用不支持 SSR 的功能",slug:"使用不支持-ssr-的功能",children:[]},{level:2,title:"使用 Router 方法",slug:"使用-router-方法",children:[]}],filePathRelative:"zh/advanced/cookbook/usage-of-client-app-enhance.md",git:{}}},7876:(s,n,a)=>{"use strict";a.r(n),a.d(n,{default:()=>ps});var l=a(6252);const e=(0,l.Wm)("h1",{id:"client-app-enhance-的使用方法",tabindex:"-1"},[(0,l.Wm)("a",{class:"header-anchor",href:"#client-app-enhance-的使用方法","aria-hidden":"true"},"#"),(0,l.Uk)(" Client App Enhance 的使用方法")],-1),p=(0,l.Uk)("插件 API 提供的 "),o=(0,l.Uk)("clientAppEnhanceFiles"),r=(0,l.Uk)(" Hook 允许你设置 Client App Enhance 文件的路径。你可以在你的插件或者主题中使用它："),t=(0,l.uE)('<div class="language-typescript ext-ts line-numbers-mode"><pre class="shiki" style="background-color:#1E1E1E;"><code><span class="line"><span style="color:#C586C0;">import</span><span style="color:#D4D4D4;"> { </span><span style="color:#9CDCFE;">path</span><span style="color:#D4D4D4;"> } </span><span style="color:#C586C0;">from</span><span style="color:#D4D4D4;"> </span><span style="color:#CE9178;">&#39;@vuepress/utils&#39;</span></span>\n<span class="line"></span>\n<span class="line"><span style="color:#569CD6;">const</span><span style="color:#D4D4D4;"> </span><span style="color:#4FC1FF;">pluginOrTheme</span><span style="color:#D4D4D4;"> = {</span></span>\n<span class="line"><span style="color:#D4D4D4;">  </span><span style="color:#9CDCFE;">clientAppEnhanceFiles:</span><span style="color:#D4D4D4;"> </span><span style="color:#9CDCFE;">path</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">resolve</span><span style="color:#D4D4D4;">(</span><span style="color:#9CDCFE;">__dirname</span><span style="color:#D4D4D4;">, </span><span style="color:#CE9178;">&#39;./path/to/clientAppEnhance.ts&#39;</span><span style="color:#D4D4D4;">),</span></span>\n<span class="line"><span style="color:#D4D4D4;">}</span></span>\n<span class="line"></span></code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div>',1),c=(0,l.Uk)("然后，创建 "),D=(0,l.Wm)("code",null,"clientAppEnhance.ts",-1),i=(0,l.Uk)(" 文件。你可以使用 "),y=(0,l.Uk)("defineClientAppEnhance"),C=(0,l.Uk)(" Helper 来获取类型提示。注意这个函数既可以是同步的，也可以是异步的。"),u=(0,l.uE)('<div class="language-typescript ext-ts line-numbers-mode"><pre class="shiki" style="background-color:#1E1E1E;"><code><span class="line"><span style="color:#C586C0;">import</span><span style="color:#D4D4D4;"> { </span><span style="color:#9CDCFE;">defineClientAppEnhance</span><span style="color:#D4D4D4;"> } </span><span style="color:#C586C0;">from</span><span style="color:#D4D4D4;"> </span><span style="color:#CE9178;">&#39;@vuepress/client&#39;</span></span>\n<span class="line"></span>\n<span class="line"><span style="color:#C586C0;">export</span><span style="color:#D4D4D4;"> </span><span style="color:#C586C0;">default</span><span style="color:#D4D4D4;"> </span><span style="color:#DCDCAA;">defineClientAppEnhance</span><span style="color:#D4D4D4;">(({ </span><span style="color:#9CDCFE;">app</span><span style="color:#D4D4D4;">, </span><span style="color:#9CDCFE;">router</span><span style="color:#D4D4D4;">, </span><span style="color:#9CDCFE;">siteData</span><span style="color:#D4D4D4;"> }) </span><span style="color:#569CD6;">=&gt;</span><span style="color:#D4D4D4;"> {</span></span>\n<span class="line"><span style="color:#D4D4D4;">  </span><span style="color:#6A9955;">// ...</span></span>\n<span class="line"><span style="color:#D4D4D4;">})</span></span>\n<span class="line"></span></code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div>',1),m=(0,l.Wm)("code",null,"app",-1),d=(0,l.Uk)(" 是由 "),h={href:"https://v3.cn.vuejs.org/api/application-api.html",target:"_blank",rel:"noopener noreferrer"},b=(0,l.Uk)("createApp"),E=(0,l.Uk)(" 创建的 Vue 应用实例。"),f=(0,l.Wm)("code",null,"router",-1),k=(0,l.Uk)(" 是由 "),g={href:"https://next.router.vuejs.org/zh/api/index.html#createrouter",target:"_blank",rel:"noopener noreferrer"},v=(0,l.Uk)("createRouter"),A=(0,l.Uk)(" 创建的路由实例。"),W=(0,l.Wm)("code",null,"siteData",-1),U=(0,l.Uk)(" 是一个根据用户配置生成的对象，包含 "),F=(0,l.Uk)("base"),_=(0,l.Uk)(", "),x=(0,l.Uk)("lang"),S=(0,l.Uk)(", "),w=(0,l.Uk)("title"),z=(0,l.Uk)(", "),R=(0,l.Uk)("description"),M=(0,l.Uk)(", "),j=(0,l.Uk)("head"),V=(0,l.Uk)(" 和 "),O=(0,l.Uk)("locales"),P=(0,l.Uk)("。"),H=(0,l.Wm)("p",null,"Client App Enhance 会在客户端应用创建后被调用，它可以为 Vue 应用添加任意功能。",-1),B=(0,l.Wm)("div",{class:"custom-container tip"},[(0,l.Wm)("p",{class:"custom-container-title"},"提示"),(0,l.Wm)("p",null,[(0,l.Uk)("为了方便用户配置使用， "),(0,l.Wm)("code",null,".vuepress/clientAppEnhance.{js,ts}"),(0,l.Uk)(" 文件会被隐式地用作 Client App Enhance 文件，除非你在配置文件中显式设置了 "),(0,l.Wm)("code",null,"clientAppEnhanceFiles"),(0,l.Uk)(" 。")])],-1),I=(0,l.Wm)("h2",{id:"注册-vue-组件",tabindex:"-1"},[(0,l.Wm)("a",{class:"header-anchor",href:"#注册-vue-组件","aria-hidden":"true"},"#"),(0,l.Uk)(" 注册 Vue 组件")],-1),L=(0,l.Uk)("你可以通过 "),N={href:"https://v3.cn.vuejs.org/api/application-api.html#component",target:"_blank",rel:"noopener noreferrer"},T=(0,l.Uk)("component"),Y=(0,l.Uk)(" 方法来注册 Vue 全局组件："),q=(0,l.uE)('<div class="language-typescript ext-ts line-numbers-mode"><pre class="shiki" style="background-color:#1E1E1E;"><code><span class="line"><span style="color:#C586C0;">import</span><span style="color:#D4D4D4;"> { </span><span style="color:#9CDCFE;">defineClientAppEnhance</span><span style="color:#D4D4D4;"> } </span><span style="color:#C586C0;">from</span><span style="color:#D4D4D4;"> </span><span style="color:#CE9178;">&#39;@vuepress/client&#39;</span></span>\n<span class="line"><span style="color:#C586C0;">import</span><span style="color:#D4D4D4;"> </span><span style="color:#9CDCFE;">MyComponent</span><span style="color:#D4D4D4;"> </span><span style="color:#C586C0;">from</span><span style="color:#D4D4D4;"> </span><span style="color:#CE9178;">&#39;./MyComponent.vue&#39;</span></span>\n<span class="line"></span>\n<span class="line"><span style="color:#C586C0;">export</span><span style="color:#D4D4D4;"> </span><span style="color:#C586C0;">default</span><span style="color:#D4D4D4;"> </span><span style="color:#DCDCAA;">defineClientAppEnhance</span><span style="color:#D4D4D4;">(({ </span><span style="color:#9CDCFE;">app</span><span style="color:#D4D4D4;">, </span><span style="color:#9CDCFE;">router</span><span style="color:#D4D4D4;">, </span><span style="color:#9CDCFE;">siteData</span><span style="color:#D4D4D4;"> }) </span><span style="color:#569CD6;">=&gt;</span><span style="color:#D4D4D4;"> {</span></span>\n<span class="line"><span style="color:#D4D4D4;">  </span><span style="color:#9CDCFE;">app</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">component</span><span style="color:#D4D4D4;">(</span><span style="color:#CE9178;">&#39;MyComponent&#39;</span><span style="color:#D4D4D4;">, </span><span style="color:#9CDCFE;">MyComponent</span><span style="color:#D4D4D4;">)</span></span>\n<span class="line"><span style="color:#D4D4D4;">})</span></span>\n<span class="line"></span></code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><h2 id="使用不支持-ssr-的功能" tabindex="-1"><a class="header-anchor" href="#使用不支持-ssr-的功能" aria-hidden="true">#</a> 使用不支持 SSR 的功能</h2><p>VuePress 会在构建过程中生成一个 SSR 应用，用以对页面进行预渲染。一般而言，如果一段代码在客户端应用 Mount 之前就使用了浏览器或 DOM API ，我们就认为其对 SSR 不友好，即不支持 SSR 。</p>',3),G=(0,l.Uk)("我们已经提供了一个 "),J=(0,l.Uk)("ClientOnly"),K=(0,l.Uk)(" 组件来包裹不支持 SSR 的内容。"),Q=(0,l.Uk)("在 Client App Enhance 文件中，你可以使用 "),X=(0,l.Wm)("code",null,"__SSR__",-1),Z=(0,l.Uk)(" 标记来处理这种情况。"),$=(0,l.uE)('<div class="language-typescript ext-ts line-numbers-mode"><pre class="shiki" style="background-color:#1E1E1E;"><code><span class="line"><span style="color:#C586C0;">import</span><span style="color:#D4D4D4;"> { </span><span style="color:#9CDCFE;">defineClientAppEnhance</span><span style="color:#D4D4D4;"> } </span><span style="color:#C586C0;">from</span><span style="color:#D4D4D4;"> </span><span style="color:#CE9178;">&#39;@vuepress/client&#39;</span></span>\n<span class="line"></span>\n<span class="line"><span style="color:#C586C0;">export</span><span style="color:#D4D4D4;"> </span><span style="color:#C586C0;">default</span><span style="color:#D4D4D4;"> </span><span style="color:#DCDCAA;">defineClientAppEnhance</span><span style="color:#D4D4D4;">(</span><span style="color:#569CD6;">async</span><span style="color:#D4D4D4;"> ({ </span><span style="color:#9CDCFE;">app</span><span style="color:#D4D4D4;">, </span><span style="color:#9CDCFE;">router</span><span style="color:#D4D4D4;">, </span><span style="color:#9CDCFE;">siteData</span><span style="color:#D4D4D4;"> }) </span><span style="color:#569CD6;">=&gt;</span><span style="color:#D4D4D4;"> {</span></span>\n<span class="line"><span style="color:#D4D4D4;">  </span><span style="color:#C586C0;">if</span><span style="color:#D4D4D4;"> (!</span><span style="color:#9CDCFE;">__SSR__</span><span style="color:#D4D4D4;">) {</span></span>\n<span class="line"><span style="color:#D4D4D4;">    </span><span style="color:#569CD6;">const</span><span style="color:#D4D4D4;"> </span><span style="color:#4FC1FF;">nonSsrFriendlyModule</span><span style="color:#D4D4D4;"> = </span><span style="color:#C586C0;">await</span><span style="color:#D4D4D4;"> </span><span style="color:#569CD6;">import</span><span style="color:#D4D4D4;">(</span><span style="color:#CE9178;">&#39;non-ssr-friendly-module&#39;</span><span style="color:#D4D4D4;">)</span></span>\n<span class="line"><span style="color:#D4D4D4;">    </span><span style="color:#6A9955;">// ...</span></span>\n<span class="line"><span style="color:#D4D4D4;">  }</span></span>\n<span class="line"><span style="color:#D4D4D4;">})</span></span>\n<span class="line"></span></code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><h2 id="使用-router-方法" tabindex="-1"><a class="header-anchor" href="#使用-router-方法" aria-hidden="true">#</a> 使用 Router 方法</h2>',2),ss=(0,l.Uk)("你可以使用 vue-router 提供的 "),ns={href:"https://next.router.vuejs.org/zh/api/index.html#router-%E6%96%B9%E6%B3%95",target:"_blank",rel:"noopener noreferrer"},as=(0,l.Uk)("Router 方法"),ls=(0,l.Uk)(" 。例如，添加导航钩子："),es=(0,l.uE)('<div class="language-typescript ext-ts line-numbers-mode"><pre class="shiki" style="background-color:#1E1E1E;"><code><span class="line"><span style="color:#C586C0;">import</span><span style="color:#D4D4D4;"> { </span><span style="color:#9CDCFE;">defineClientAppEnhance</span><span style="color:#D4D4D4;"> } </span><span style="color:#C586C0;">from</span><span style="color:#D4D4D4;"> </span><span style="color:#CE9178;">&#39;@vuepress/client&#39;</span></span>\n<span class="line"></span>\n<span class="line"><span style="color:#C586C0;">export</span><span style="color:#D4D4D4;"> </span><span style="color:#C586C0;">default</span><span style="color:#D4D4D4;"> </span><span style="color:#DCDCAA;">defineClientAppEnhance</span><span style="color:#D4D4D4;">(({ </span><span style="color:#9CDCFE;">app</span><span style="color:#D4D4D4;">, </span><span style="color:#9CDCFE;">router</span><span style="color:#D4D4D4;">, </span><span style="color:#9CDCFE;">siteData</span><span style="color:#D4D4D4;"> }) </span><span style="color:#569CD6;">=&gt;</span><span style="color:#D4D4D4;"> {</span></span>\n<span class="line"><span style="color:#D4D4D4;">  </span><span style="color:#9CDCFE;">router</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">beforeEach</span><span style="color:#D4D4D4;">((</span><span style="color:#9CDCFE;">to</span><span style="color:#D4D4D4;">) </span><span style="color:#569CD6;">=&gt;</span><span style="color:#D4D4D4;"> {</span></span>\n<span class="line"><span style="color:#D4D4D4;">    </span><span style="color:#9CDCFE;">console</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">log</span><span style="color:#D4D4D4;">(</span><span style="color:#CE9178;">&#39;before navigation&#39;</span><span style="color:#D4D4D4;">)</span></span>\n<span class="line"><span style="color:#D4D4D4;">  })</span></span>\n<span class="line"></span>\n<span class="line"><span style="color:#D4D4D4;">  </span><span style="color:#9CDCFE;">router</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">afterEach</span><span style="color:#D4D4D4;">((</span><span style="color:#9CDCFE;">to</span><span style="color:#D4D4D4;">) </span><span style="color:#569CD6;">=&gt;</span><span style="color:#D4D4D4;"> {</span></span>\n<span class="line"><span style="color:#D4D4D4;">    </span><span style="color:#9CDCFE;">console</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">log</span><span style="color:#D4D4D4;">(</span><span style="color:#CE9178;">&#39;after navigation&#39;</span><span style="color:#D4D4D4;">)</span></span>\n<span class="line"><span style="color:#D4D4D4;">  })</span></span>\n<span class="line"><span style="color:#D4D4D4;">})</span></span>\n<span class="line"></span></code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div><div class="custom-container warning"><p class="custom-container-title">注意</p><p>我们不推荐使用 <code>addRoute</code> 方法来添加动态路由，因为这些路由记录 <strong>不会</strong> 在构建模式中被预渲染出来。</p><p>当然，如果你了解了这种用法的缺点，你还是可以这样使用。</p></div>',2),ps={render:function(s,n){const a=(0,l.up)("RouterLink"),ps=(0,l.up)("OutboundLink");return(0,l.wg)(),(0,l.j4)(l.HY,null,[e,(0,l.Wm)("p",null,[p,(0,l.Wm)(a,{to:"/zh/reference/plugin-api.html#clientappenhancefiles"},{default:(0,l.w5)((()=>[o])),_:1}),r]),t,(0,l.Wm)("p",null,[c,D,i,(0,l.Wm)(a,{to:"/zh/reference/client-api.html#defineclientappenhance"},{default:(0,l.w5)((()=>[y])),_:1}),C]),u,(0,l.Wm)("ul",null,[(0,l.Wm)("li",null,[m,d,(0,l.Wm)("a",h,[b,(0,l.Wm)(ps)]),E]),(0,l.Wm)("li",null,[f,k,(0,l.Wm)("a",g,[v,(0,l.Wm)(ps)]),A]),(0,l.Wm)("li",null,[W,U,(0,l.Wm)(a,{to:"/zh/reference/config.html#base"},{default:(0,l.w5)((()=>[F])),_:1}),_,(0,l.Wm)(a,{to:"/zh/reference/config.html#lang"},{default:(0,l.w5)((()=>[x])),_:1}),S,(0,l.Wm)(a,{to:"/zh/reference/config.html#title"},{default:(0,l.w5)((()=>[w])),_:1}),z,(0,l.Wm)(a,{to:"/zh/reference/config.html#description"},{default:(0,l.w5)((()=>[R])),_:1}),M,(0,l.Wm)(a,{to:"/zh/reference/config.html#head"},{default:(0,l.w5)((()=>[j])),_:1}),V,(0,l.Wm)(a,{to:"/zh/reference/config.html#locales"},{default:(0,l.w5)((()=>[O])),_:1}),P])]),H,B,I,(0,l.Wm)("p",null,[L,(0,l.Wm)("a",N,[T,(0,l.Wm)(ps)]),Y]),q,(0,l.Wm)("p",null,[G,(0,l.Wm)(a,{to:"/zh/reference/components.html#clientonly"},{default:(0,l.w5)((()=>[J])),_:1}),K]),(0,l.Wm)("p",null,[Q,(0,l.Wm)(a,{to:"/zh/reference/client-api.html#ssr"},{default:(0,l.w5)((()=>[X])),_:1}),Z]),$,(0,l.Wm)("p",null,[ss,(0,l.Wm)("a",ns,[as,(0,l.Wm)(ps)]),ls]),es],64)}}}}]);